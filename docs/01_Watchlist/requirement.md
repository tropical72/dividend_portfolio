# Requirement: Watchlist (01)

## [REQ-WCH-01] 종목 추가 및 관리
- **[REQ-WCH-01.1] 추가 방식:** 티커(Ticker) 입력 및 국가(US/KR) 선택 후 'Add' 버튼 또는 'Enter' 키로 추가.
- **[REQ-WCH-01.2] 컨텍스트 메뉴:** 테이블에서 다중 종목 선택 후 우클릭 시 '포트폴리오에 추가' 메뉴 노출.
- **[REQ-WCH-01.3] 중복 방지:** 이미 등록된 티커 추가 시 경고 알림 및 추가 차단.
- **[REQ-WCH-01.4] 유효성 검사:** 존재하지 않는 티커 등 조회 실패 시 경고 메시지 표시 및 목록 제외.
- **[REQ-WCH-01.5] 영속성:** 프로그램 종료 후 재시작 시에도 티커 및 국가 정보 유지 ([REQ-SYS-03.1] 참조).
- **[REQ-WCH-01.6] 다중 선택 및 삭제:** 
    - 테이블 각 행에 체크박스를 제공하여 복수 종목 선택 가능.
    - 헤더 체크박스를 통해 '전체 선택/해제' 기능 지원.
    - 1개 이상 선택 시 'Delete Selected' 버튼 노출 및 일괄 삭제 수행.
- **[REQ-WCH-01.7] 스마트 티커 감지:** 
    - 사용자가 국가를 'US'로 선택했더라도, 입력된 티커가 **6자리(숫자 및 영문 조합)**일 경우 자동으로 한국 종목(.KS)으로 간주하여 조회를 시도함 (예: 0104H0, 00593A 등).
    - 사용자 실수로 인한 조회 실패를 최소화함.

## [REQ-WCH-02] 사용자 경험 (UX) 개선
- **[REQ-WCH-02.1] 처리 중 표시:** 데이터 조회 중 'Add' 버튼 비활성화 및 "Adding..." 텍스트 변경, 마우스 커서 대기 상태 표시 ([GS-UX-01] 준수).
- **[REQ-WCH-02.2] 자동 스크롤:** 종목 추가 성공 시 해당 항목이 보이도록 테이블 자동 스크롤.
- **[REQ-WCH-02.3] 상태 알림:** 추가 성공 시 상태바(Status Bar)에 일시적 메시지 표시 ([GS-UI-02] 준수).
- **[REQ-WCH-02.4] 삭제 확인:** 종목 삭제 시 사용자 확인 대화상자(Confirm Dialog) 표시.
- **[REQ-WCH-02.5] 데이터 무결성 보호:** 포트폴리오(저장된 것 및 현재 탭 구성 중인 것 포함)에 포함된 종목은 삭제를 방지하고 경고 표시.

## [REQ-WCH-03] 데이터 표시 및 기능
- **[REQ-WCH-03.1] 필수 컬럼:** Ticker, Name(긴 이름은 두 줄 이상으로 표시), Price, Annual Yield(%), 1-Yr Total Return(%), Last Ex-Div Date, Last Dividend Amount, Last Div Yield(%), Past Avg. Monthly Div.
- **[REQ-WCH-03.8] 종목명 가독성 보장:** 이름이 긴 종목(예: 일부 ETF)이 테이블에서 잘리지 않도록 Name 컬럼의 최소 너비를 충분히 확보하고, 필요한 경우 자동 줄바꿈(Multi-line)을 적용함.
- **[REQ-WCH-03.2] 배당 주기 표시:** 종목별 배당 주기(월/분기/반기/연) 및 지급 월 표시 컬럼 추가.
- **[REQ-WCH-03.3] 테이블 기능:** 모든 데이터는 읽기 전용(Read-only)이며, 헤더 클릭 시 정렬 기능 제공.
- **[REQ-WCH-03.4] 금액 포맷팅:** 모든 주가 및 배당금은 [GS-UI-01] 표준 포맷을 따름.
- **[REQ-WCH-03.5] 통화 단위 명시:** Price, Last Amt, Monthly 컬럼 등 금액 데이터에는 해당 종목의 통화 단위(USD/KRW)를 반드시 병기함.
- **[REQ-WCH-03.6] 컬럼 정합성:** 모든 데이터 필드(Ticker, Name, Price, Yield, Cycle, 1-Yr Rtn, Ex-Div, Last Amt, Monthly)는 대응하는 헤더를 가져야 함.
- **[REQ-WCH-03.7] 수익률 방식 명시:** Yield 컬럼 헤더에 TTM(Trailing Twelve Months) 방식을 명시하여, 주식 페이지(Forward 방식)와의 수치 차이에 대한 사용자의 혼동을 방지함.

## [REQ-WCH-04] 한국 종목 및 ETF 데이터 특화 [D-03 대응]
- **[REQ-WCH-04.1] Source of Truth:** 한국 일반 종목(.KS, .KQ)은 DART(OpenDart)를 최우선으로 하며, yfinance는 보조 수단으로 활용함.
- **[REQ-WCH-04.2] ETF 및 월배당 데이터 보정:** 
    - DART 공시가 없는 ETF 및 일부 월배당 종목은 yfinance의 실측 배당 이력(`dividends`)을 최우선으로 활용함.
    - 배당 수익률(Yield)이 0으로 조회될 경우, 최근 1년치 배당금 합계(TTM)를 현재가로 나누어 수익률을 역산하여 표시함.
- **[REQ-WCH-04.4] 배당 주기 판별 고도화:** 
    - 단순 지급 횟수뿐만 아니라, DART 공시 전문의 '분기배당', '중간배당' 키워드를 분석하여 주기를 확정함.
    - 실측 데이터가 부족하더라도 공시상 분기배당주라면 'Quarterly'로 우선 표시함.
- **[REQ-WCH-04.5] 신규 종목 데이터 불충분 표기:** 
    - 첫 배당 지급일로부터 1년(365일)이 경과하지 않은 종목은 배당 주기 뒤에 **'(New)'** 정보를 추가함.
    - **UI 색상 규칙:** 확정된 주기(New가 없는 경우)는 **초록색(Emerald)**으로, 미확정(New) 및 데이터 없음(None)은 **회색(Slate)**으로 표시하여 데이터 신뢰도를 시각화함.
    - (New) 라벨은 주기 레이블 하단에 회색으로 줄바꿈하여 표시함.
- **[REQ-WCH-04.3] 배당락일(Ex-Div) 최신화:** 배당락일 정보가 유실된 경우, 배당 이력 중 가장 최근 지급 확정일을 배당락일로 자동 매핑하여 공백을 방지함.

## 관련 파일 (Related Files)
- `src/frontend/src/components/WatchlistTab.tsx` (UI 및 테이블 렌더링)
- `src/backend/api.py` (FastAPI 라우터)
- `src/backend/data_provider.py` (배당 데이터 수집 및 TTM 계산 엔진)
